# 分支限界

## 相关概念

### 组合优化问题

组合优化问题有几个主要的概念：

* 目标函数：通常需要将这个函数极大化或极小化
* 约束条件：问题的解需要满足这个条件
* 可行解：搜索空间中满足约束条件的解
* 最优解：使目标函数极大或极小的可行解

举个组合优化问题的例子：背包问题。

设背包最大重量为10，物品的信息如下：

| 物品 |  a   |  b   |  c   |  d   |
| :--: | :--: | :--: | :--: | :--: |
| $v$  |  1   |  3   |  5   |  9   |
| $w$  |  2   |  3   |  4   |  7   |

那么这个问题的

* 目标函数：$x_1+3x_2+5x_3+9x_4$
* 约束条件：$2x_1+3x_2+4x_3+7x_4 \le 10$

### 代价函数、界

代价函数是以当前节点为根的子树中对目标函数的上界或下界。

代价函数是针对搜索树的节点的，每个节点都有一个代价函数。

以下图为例，节点$A$的代价函数$F$，那么以$A$为根的整棵子树的节点计算的目标函数的值都不会超过$F$的值（极小化问题相反）。

**注意，一个节点的代价函数不等于该节点的目标函数计算值，而是整棵子树中节点的上界或下界**。具体怎么计算代价函数要看具体问题。

![](https://raw.githubusercontent.com/yamsfeer/pic-bed/master/e6c9d24egy1h236oxfn1qj20d806n0sv.jpg)

界的概念类似于“在一个数组中找出最大值”算法中保存当前最大值的变量。

以上图为例，在搜索解的过程中，找到一个可行解$X$，令目标函数$f(X)$为整个搜索过程的界，当搜索到下一个可行解$Y$且目标函数$f(Y) \ge f(X)$时，更新界的值。

当然，$f(Y)$的值肯定不大于$F$，因为$Y$在$A$的子树中。

:::tip

通俗地说，界就是当前已求得的可行解的最大值，代价函数就是这个节点及其子树的上限值。

如果代价函数小于等于界的值，则没必要继续往下寻找，继续往下找也不可能超过代价函数的值，更何况界的值。

通过代价函数与界的比较，可以提前回溯，提高搜索速度。

:::

### 分支限界

分支限界的作用是**在回溯算法中帮助提前回溯**。

在回溯算法中，回溯到父节点有两种情况：

1. 不满足约束条件

   一旦不满足约束条件，当前分支继续找下去也肯定不满足约束条件，此时可以回溯。

2. 代价函数小于当前界（极小化问题相反）

   如果当前节点A的代价函数F小于当前界，意味着A的子树中不存在目标函数大于F的节点，也就是说，A的子树中没有更好的解。因此不需要搜索A的子树，可以提前回溯。

## 分支限界与背包问题

设背包最大重量为10，物品的信息如下：

| 物品 |  a   |  b   |  c   |  d   |
| :--: | :--: | :--: | :--: | :--: |
| $v$  |  1   |  3   |  5   |  9   |
| $w$  |  2   |  3   |  4   |  7   |

设每个物品装入的个数为$x_1,\dots,x_4$，则有

* 目标函数：$x_1+3x_2+5x_3+9x_4$
* 约束条件：$2x_1+3x_2+4x_3+7x_4 \le 10$

### 背包问题的代价函数设定

将各个物品按单位价值$\displaystyle \frac{v_i}{w_i}$从大到小排序，假设当前已装入$k$个物品，那么

代价函数 = 已装入价值 + $\Delta$

* $\Delta$表示还可以继续装入的最大价值的上界

* $\Delta$ = 背包剩余重量 $\times$ 下一个可装物品的单位价值

* 如果$\Delta = 0$，表示背包不再可装入物品

通俗地讲，当背包已被占用一半的重量，剩余的一半重量应尽量放入高价值（单位价值最大）的物品，这就是排序的作用。

### 求解过程

将各个物品按单位价值$\displaystyle \frac{v_i}{w_i}$从大到小排序，排序后：

* 目标函数：$9x_1+5x_2+3x_3+x_4$
* 约束条件：$7x_1+4x_2+3x_3+2x_4 \le 10$

用分支限界求解背包问题时，有两种情况需要回溯：

* 超出背包最大重量
* 当前节点的代价函数小于界（意味着下面没有更好的解）

令界初始值为0，每当求得一个可行解，计算其目标函数的值并与界比较，如果大于界，则更新界的值。

求解过程如下图：

<img src="https://raw.githubusercontent.com/yamsfeer/pic-bed/master/008i3skNgy1guptsc1issj60ml0jgmz802.jpg"  />

如图所示，蓝色的节点是超出背包重量的节点，黄色节点是代价函数小于界的节点，这两种情况都可以回溯。

这就是分支限界在回溯中的应用。
