# 背包问题

一个旅行者有一个背包及$n$种物品，每种物品的重量为$w_i$价值为$v_i$，背包最大重量为$b$，每种物品可放多个。假设$w_i,v_i,b$都是正整数，如何选择物品使得背包价值最大？

来看个具体例子：

$n = 4, b = 10$（4种物品，背包最大重量10），物品重量及价值如下：

|      |  a   |  b   |  c   |  d   |
| :--: | :--: | :--: | :--: | :--: |
| $v$  |  1   |  3   |  5   |  9   |
| $w$  |  2   |  3   |  4   |  7   |

## 问题建模

解：$<x_1,x_2, \dots ,x_n>$（$x_i$是装入背包的第$i$种物品的个数）

目标函数：$max \displaystyle \sum ^n _{i=1} {v_ix_i}$（背包价值最大）

约束条件：$\displaystyle \sum ^n _{i=1} {w_ix_i \le b}$（不能超出背包最大重量）

### 子问题界定

用参数$k$和$y$划分子问题，其中

* $k$：考虑对物品$1,2,\dots ,k$的选择

* $y$：背包总重量不超过$y$

令$k = 1,2,\dots,n$，对于给定的$k$，令$y=1,2,\dots,b$，这样就得到了一系列子问题。

### 优化函数

考虑装前$k$种物品，总重量不超过$y$，设此时背包能达到的最大价值为$F_k(y)$。

对于$F_k(y)$方程，当判断第$k$中物品时，要么全部放物品$k$直到满负重，要么放入一件物品$k$，剩余重量放前$k$种物品（物品$k$可以放0件或多件）。

上述过程可表示为递推方程：
$$
F_k(y)=max\{F_{k-1}(y), \ F_k(y-w_k) + v_k \}
$$
以下是$F_k(y)$方程的边界情况：

* $y < 0$时，$F_k(y) = -\infty$

* $F_0(y) = 0, \ F_k(0) = 0$

* $F_1(y)= \displaystyle \lfloor \displaystyle \frac {y} {w_i}  \displaystyle\rfloor v_i$

### 标记函数

$i_k(y)$：装前$k$种物品，总重不超过$y$，背包达到最大价值时**装入物品的最大标号**。

$F_k(y-w_k)+v_k$：装入第$k$件物品后背包的最大价值。

当装入前$k-1$件物品的最大价值大于装入第$k$件物品时，说明物品$k$不值得装入背包，此时最大标号取$i_{k-1}(y)$，否则取$k$。

表示为方程：

* $i_k(y) = i_{k-1}(y), \quad F_{k-1}(y) > F_k(y-w_k) + v_k$ （物品$k$不值得装）
* $i_k(y) = k, \quad F_{k-1}(y) \le F_k(y-w_k)+v_k$（物品$k$值得装）

$i_k(y)$的初始情况：

* $i_1(y)=0, \quad y<w_1$
* $i_1(y)=1, \quad y\ge w_1$

## 计算过程

针对实例：$n = 4, b = 10$

|      |  a   |  b   |  c   |  d   |
| :--: | :--: | :--: | :--: | :--: |
| $v$  |  1   |  3   |  5   |  9   |
| $w$  |  2   |  3   |  4   |  7   |

$F_k(y)$的计算结果如下表：

| $k \downarrow \quad y \rightarrow$ |  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |  9   |               10                |
| :--------------------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :-----------------------------: |
|                 1                  |  0   |  1   |  1   |  2   |  2   |  3   |  3   |  4   |  4   |                5                |
|                 2                  |  0   |  1   |  3   |  3   |  4   |  6   |  6   |  7   |  9   |                9                |
|                 3                  |  0   |  1   |  3   |  5   |  5   |  6   |  8   |  10  |  10  |               11                |
|                 4                  |  0   |  1   |  3   |  5   |  5   |  6   |  9   |  10  |  10  | <span style="color: red">**12**</span> |

由上表可知，最优解中，背包能达到最大的价值为12。

$i_k(y)$的计算如下表：*（为了避免混淆，物品号用abcd表示）*

| $k \downarrow \quad y \rightarrow$ |               1                |  2   |               3                |  4   |  5   |  6   |  7   |  8   |  9   |               10               |
| :--------------------------------: | :----------------------------: | :--: | :----------------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :----------------------------: |
|                 1                  |               0                |  a   |               a                |  a   |  a   |  a   |  a   |  a   |  a   |               a                |
|                 2                  | <span style="color: red">**0**</span> |  a   |               b                |  b   |  b   |  b   |  b   |  b   |  b   |               b                |
|                 3                  |               0                |  a   |               b                |  c   |  c   |  c   |  c   |  c   |  c   |               c                |
|                 4                  |               0                |  a   | <span style="color: red">**b**</span> |  c   |  c   |  c   |  d   |  c   |  d   | <span style="color: red">**d**</span> |

* $i_4(10)=4 \Rightarrow x_4 \ge 1$

  达到最大重量时最大物品号为d，说明物品d至少放入一件

* $i_4(10-w_4)=i_4(3)=2 \Rightarrow x_2 \ge 1,x_4=1,x_3=0$

  物品d重量为7，剩余的重量为3，查$i_k(y)$表得知填满重量3的最大物品号为b，那么物品b至少装1件，物品c没装。

* $i_(3-w_2)=i_2(0)=0 \Rightarrow x_2=1,x_1=0$

  装入物品b至少一件、物品d一件后，已没有多余重量可分配，所以物品b、d只装入1件，物品a、c没装。

综上可得解：$x_1=0,x_2=1,x_3=0,x_4=1$，最大价值**12**。

*时间复杂度O(nb)（计算略）*。

### 背包问题的推广

* **0-1背包问题**：一种物品最多装入1件
* **多背包问题**：有多个背包，每个背包都有重量限制，所有背包不超重情况下使物品价值最大。
* **二维背包**：每件物品有重量和体积，背包有重量和体积的限制，使物品价值最大。
