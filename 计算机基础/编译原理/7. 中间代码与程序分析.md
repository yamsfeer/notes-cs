# 中间代码与程序分析

在简单的编译器中，可能会把抽象语法树直接生成汇编代码；但是在现代编译器中，一般会经多步生成多个中间表示之后，再生成汇编代码。

常见的中间表示有：

* 树和有向无环图（*DAG, Directed Acyclic Graph*）

  这是一种高层表示，适用于程序源代码

* 三地址码（*3-address code*）

  低层表示，靠近目标机器

* 控制流图（*CFG, control-flow graph*）

  更精细的三地址码，是程序的图状表示。适合做程序分析、程序优化等。

* 静态单赋值形式（*SSA, static single assignment form*）

  更精细的控制流图，同时编码控制流信息和数据流信息。

* 连续传递风格（*CPS, Continuation-passing style*）

  更一般的SSA。

之所以要划分成不同的中间表示，主要出于**编译器工程上的考虑**和**程序分析和代码优化的需要**。

从编译器工程上来说：

* 阶段划分：把整个编译过程划分成不同的阶段
* 任务分解：每个阶段只处理翻译过程的一个步骤
* 代码工程：代码更容易实现、除错、维护和演进

**程序分析**和**代码优化**都和程序的中间表示密切相关，许多优化在特定的中间表示上才可以进行或容易进行。

:::info

需要注意的是，目前不存在一种通用编译器语言IR，使得所有编程语言可以通过翻译成IR后再翻译成目标机器汇编来屏蔽底层差异。

:::

本章将全面讨论中间表示涉及的重要问题和解决方案。

* 中间代码表示：详细介绍现代编译器的几种常用的重要中间表示
  * 三地址码
  * 控制流图
  * 静态单复制形式
* 程序分析：详细介绍在中间表示上做程序分析的理论和技术
  * 控制流分析
  * 数据流分析
    * 到达定义分析
    * 活性分析

