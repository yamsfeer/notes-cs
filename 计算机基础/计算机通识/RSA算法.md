# RSA 算法

加密算法可以分为两种：

* 对称加密：使用同一份密钥进行加密和解密

* 非对称加密：生成一对密钥，公钥和私钥，公钥公开，私钥保密

  用公钥加密信息，只能用对应的私钥解密；同样地，用私钥加密，也只能用对应的公钥解密。

RSA 算法是非对称加密算法的一种，由三位数学家设计并用他们名字的首字母命名。

:::tip

一句话概括 RSA 算法：生成一对密钥，分为公钥和私钥，**公钥加密，私钥解密**。

:::

下面介绍 RSA 算法密钥的生成步骤和如何使用密钥，具体证明过程略。

## 密钥生成步骤

<img src="https://raw.githubusercontent.com/yamsfeer/pic-bed/master/RSA算法.png" style="zoom:80%;" class="img-mid" />

1. 随机选择两个不相等的质数 $p$ 和 $q$

   假设 $p=61,q=53$

2. 计算 $p$ 和 $q$ 的乘积 $n=p \times q$

   $n=61 \times 53=3233$

   $n$ 的二进制数长度就是密钥长度。3233 写成二进制是 110010100001，共 12 位，所以将来生成的密钥就是 12 位。

   实际应用中，RSA密钥一般是 1024 位，重要场合则为 2048 位。

3. 计算 $n$ 的欧拉函数 $\varphi(n)=(p-1)(q-1)$

   $\varphi(n)=3120$

4. 随机选择一个整数 $e$，条件是$1< e < \varphi(n)$，且 $e$ 与$\varphi(n)$ 互质

   假设 $e=17$ ( 实际应用常选择 65537 )。

5. 计算 $e$ 对于 $\varphi(n)$ 的模反元素 $d$

   模反元素是指存在一个整数 $d$，使得 $ed$ 对 $\varphi(n)$ 取模为 1
   $$
   ed \ mod \ \varphi(n) = 1
   $$
   这个式子等价于：
   $$
   ed = k\varphi(n) + 1 \quad \Rightarrow \quad ed = k\varphi(n) + 1
   $$
   这是一个二元一次方程，用我们比较熟悉的形式表示为：
   $$
   ex + \varphi(n)y = 1
   $$
   已知 $e=17,\varphi(n)=3120$，代入：
   $$
   17x+3120y=1
   $$
   这个方程可以用"扩展欧几里得算法"求解，此处省略具体过程。其中一组解为 $(x,y)=(2753,-15)$，即 $d=2753$。

6. 将 $n$ 和 $e$ 封装成公钥 $(n,e)$，$n$ 和 $d$ 封装成私钥 $(n,d)$

   公钥是 $(3233,17)$，私钥是 $(3233,2753)$。

   实际应用中，公钥和私钥都采用 [ASN.1 ](https://zh.wikipedia.org/zh-cn/ASN.1) 格式表示。

## RSA 算法的可靠性

密钥生成步骤中，一共出现 6 个数字：

```
p, q, n, φ(n), e, d
```

公钥用到了 $n,e$，其余 4 个数字是不公开的。最关键的是 $d$，因为 $n$ 和 $d$ 组成了私钥，一旦 $d$ 泄漏，就等于私钥泄漏。

**那么，有无可能在已知 $n$ 和 $e$ 的情况下，推导出 $d$ ？**

1. $ed \ mod \ \varphi(n) = 1$

   $e$ 已知，想要算出 $d$，需要知道 $\varphi(n)$。

2. $\varphi(n)=(p-1)(q-1)$

   想要知道 $\varphi(n)$，需要知道 $p,q$。

3. $n=pq$

   $p,q$ 都是质数，想要算出 $p,q$，需要将 $n$ 质因数分解。

**综上，如果 $n$ 可以被质因数分解，就可以算出 $d$，这意味着私钥被破解。**

大整数的质因数分解，是非常困难的事情。目前除了暴力破解，还没有发现别的有效方法。

密钥越长越难破解。根据已经披露的文献，目前被破解的最长 RSA 密钥是 768 个**二进制位**。因此可以认为，1024 位的 RSA 密钥基本安全，2048 位的密钥极其安全。

### 因数分解和质因数分解

为避免混淆，这里介绍一下因数分解和质因数分解的关系。

因数分解和质因数分解是数学中常用的两种分解方法，用于将一个数分解成其因数的乘积。

它们之间的区别在于分解出的因数的性质。

1. 因数分解

   因数分解是将一个数分解成两个或多个因数的乘积，这些因数可以是质数（素数）也可以是合数（非质数）。例如，将数字 12 进行因数分解可以得到 2 × 6 或 3 × 4 等。

2. 质因数分解

   质因数分解是将一个数分解成质因数的乘积。质因数分解的结果是将一个数表示成一系列质因数的乘积，其中每个质因数只出现一次。例如，将数字 12 进行质因数分解可以得到 2 × 2 × 3，其中 2 和 3 都是质因数。

:::tip

质数是指只能被 1 和自身整除的正整数，例如 2、3、5、7、11 等。

:::

## 用公钥加密

设明文为整数 $m=65$。

所谓加密，就是算出下式的 $c$：
$$
m^e = c \ ( \ mod \ n \ )
$$

将公钥的 $n,e$ 和需要加密的 $m$ 代入：
$$
65^{17}=2790 \ ( \ mod \ 3233 \ )
$$

求得 $c=2790$，这就是密文。

## 用私钥解密

所谓解密，就是还原出下式的 $m$：

$$
c^d = m \ ( \ mod \ n \ )
$$

将私钥的 $n,d$ 和密文 $c$ 代入：
$$
2790^{2753}=65 \ ( \ mod \ 3233 \ )
$$

求得 $m=65$。

## 对明文的要求

注意，明文 $m$ 必须是整数 ( 字符串可以用 ASCII 码或 unicode 码 )，且 $m$ 必须小于 $n$。

如果要加密大于 $n$ 的整数，有两种解决方法：

* 把长信息分割成若干段短消息，每段加密
* 先用对称加密算法如 [DES ](https://zh.wikipedia.org/wiki/资料加密标准)加密信息，再用 RSA 加密传输 DES 的密钥

## 参考

[RSA算法原理（一）](http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html)

[RSA算法原理（二）](http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html)