# setup.s

setup 占 4 个扇区，512 * 4 字节。

| 段       | 地址   | 说明     |
| -------- | ------ | -------- |
| BOOTSEG  | 0x7c00 | 历史遗留 |
| INITSEG  | 0x9000 |          |
| SETUPSEG | 0x9020 |          |

## setup 的工作

| 内存地址 | 长度（字节） | 名称       |
| -------- | ------------ | ---------- |
| 0x90000  | 2            | 光标位置   |
| 0x90002  | 2            | 拓展内存数 |
| 0x9000c  | 2            | 显卡参数   |
| 0x901fc  | 2            | 根设备号   |



* 获取内存大小
* bootset 已经读入 os，setup 会将 os 移动到 0 地址
* 进入保护模式

## 保护模式

保护模式的作用是切换到 32 为寻址模式。

原本的实模式下 cs << 4 + ip 只能访问 1M 的内存空间，32 位寻址可以访问 4G 内存。

保护模式下，有新的寻址方式和中断向量表。

cr0 寄存器，最后一位

* 1：保护模式
* 0：实模式

保护模式下，根据 cs 寄存器查 GDT ( global describe table ) 表，然后 + ip。

GDT 表似乎是在 head.S 中建立的，setup 只是将 cr0 寄存器最后一位置为 1，这就算进入保护模式了。
