# 内存管理

## 重定位

编译后的代码中的地址是逻辑地址，它需要和寄存器中的基地址结合，获取真正的地址。

```
地址 = 基地址 + 逻辑地址
```

这步操作可以在编译时、载入时、运行时完成。

注意：基地址存放在寄存器中，它会随着进程调度切换和恢复。

一个进程自身的基地址是存放在 PCB 中，进程切换时，会将 PCB 中的基地址放入寄存器。

### 编译时

### 载入时

### 运行时

## 分段

一个进程的内存是分段的

* 主程序 main，特点：只读
* 变量集
* 函数库
* 动态数组
* 栈

程序中的逻辑地址实际上是根据分段地址偏移的。

因此，具体指令中访问数据的方式是 段号，段内偏移

```assembly
mov [es:bx], ax
```



### 进程段表

每个进程都有一个进程段表，记录段的基址和长度。

| 段号 | 基址 | 长度 | 保护 |
| ---- | ---- | ---- | ---- |
| 0    | 180K | 150K | R    |
| 1    | 360K | 60K  | R/W  |
| 2    | 70K  | 110K | R/W  |
| 3    | 460K | 40K  | R    |

操作系统的进程段表就是 GDT 表，进程段表是 LDT。

LDT 本身属于进程的信息，因此存放在进程的

 PCB 中。存放当前进程的 LDT 表的位置的寄存器是 ldtr 寄存器。